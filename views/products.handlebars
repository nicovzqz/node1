{{!-- views/products.handlebars --}}
<div class="container mt-5">
    <h1 class="mb-4">Catálogo de Productos</h1>

    {{!-- Filtros y búsqueda --}}
    <div class="row mb-4">
        <div class="col-md-6">
            <form method="GET" class="form-inline">
                <div class="form-group mr-2">
                    <label for="query" class="mr-2">Filtrar por categoría:</label>
                    <select name="query" id="query" class="form-control">
                        <option value="">Todos</option>
                        <option value="category=Electrónicos" {{#if (eq currentQuery 'category=Electrónicos')}}selected{{/if}}>Electrónicos</option>
                        <option value="category=Accesorios" {{#if (eq currentQuery 'category=Accesorios')}}selected{{/if}}>Accesorios</option>
                    </select>
                </div>
                <div class="form-group mr-2">
                    <label for="sort" class="mr-2">Ordenar por precio:</label>
                    <select name="sort" id="sort" class="form-control">
                        <option value="">Sin ordenar</option>
                        <option value="asc" {{#if (eq currentSort 'asc')}}selected{{/if}}>Menor a Mayor</option>
                        <option value="desc" {{#if (eq currentSort 'desc')}}selected{{/if}}>Mayor a Menor</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Filtrar</button>
            </form>
        </div>
        <div class="col-md-6 text-right">
            <p class="text-muted">Mostrando {{products.length}} de {{totalPages}} páginas</p>
        </div>
    </div>

    {{!-- Grid de productos --}}
    <div class="row mb-4">
        {{#each products}}
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title">{{title}}</h5>
                    <p class="card-text text-muted">{{category}}</p>
                    <p class="card-text">{{description}}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="h5 mb-0">${{price}}</span>
                        <small class="text-success">Stock: {{stock}}</small>
                    </div>
                </div>
                <div class="card-footer bg-white border-top">
                    <a href="/products/{{_id}}" class="btn btn-info btn-sm btn-block">Ver Detalles</a>
                </div>
            </div>
        </div>
        {{else}}
        <div class="col-12">
            <div class="alert alert-info">No se encontraron productos</div>
        </div>
        {{/each}}
    </div>

    {{!-- Paginación --}}
    <nav aria-label="Paginación">
        <ul class="pagination justify-content-center">
            {{#if hasPrevPage}}
            <li class="page-item">
                <a class="page-link" href="{{prevLink}}">Anterior</a>
            </li>
            {{else}}
            <li class="page-item disabled">
                <span class="page-link">Anterior</span>
            </li>
            {{/if}}

            <li class="page-item active">
                <span class="page-link">Página {{page}} de {{totalPages}}</span>
            </li>

            {{#if hasNextPage}}
            <li class="page-item">
                <a class="page-link" href="{{nextLink}}">Siguiente</a>
            </li>
            {{else}}
            <li class="page-item disabled">
                <span class="page-link">Siguiente</span>
            </li>
            {{/if}}
        </ul>
    </nav>
</div>

{{!-- Registrar helper para comparación --}}
<script>
    // Este helper se registra en el servidor si es necesario
</script>
